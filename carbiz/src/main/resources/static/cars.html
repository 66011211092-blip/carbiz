<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>üöò ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏ñ | CarBiz</title>
    <style>
        body {
          font-family: "Segoe UI", sans-serif;
          background: #f8f9fa;
          margin: 0;
          color: #333;
        }
        header {
          background: #0d6efd;
          color: white;
          padding: 15px;
          font-size: 22px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        header a {
          color: white;
          text-decoration: none;
          background: rgba(255,255,255,0.2);
          padding: 5px 12px;
          border-radius: 6px;
        }
        main { padding: 30px; }
        table {
          width: 100%;
          border-collapse: collapse;
          background: white;
          border-radius: 8px;
          overflow: hidden;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
          margin-top: 10px;
        }
        th, td {
          padding: 10px;
          border-bottom: 1px solid #ddd;
          text-align: left;
        }
        th { background: #0d6efd; color: white; }
        button {
          border: none; background: #0d6efd; color: white;
          padding: 6px 10px; border-radius: 5px; cursor: pointer;
          margin: 2px;
        }
        button.delete { background: #dc3545; }
        button.edit { background: #198754; }
        form {
          background: white;
          padding: 20px;
          border-radius: 8px;
          margin-top: 20px;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        input, select {
          padding: 6px;
          margin: 4px;
          border: 1px solid #ccc;
          border-radius: 5px;
        }
        footer {
          text-align: center;
          color: #777;
          margin-top: 40px;
          padding: 10px;
        }
    </style>

    <script>
        const API_BASE = "http://localhost:8080";

        async function apiFetch(endpoint, options = {}) {
          const res = await fetch(`${API_BASE}${endpoint}`, {
            headers: { "Content-Type": "application/json" },
            ...options
          });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return await res.json();
        }

        async function loadCars() {
          const tbody = document.querySelector("#carTable tbody");
          tbody.innerHTML = "<tr><td colspan='9'>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>";
          try {
            const data = await apiFetch("/api/cars");
            if (data.length === 0) {
              tbody.innerHTML = "<tr><td colspan='9'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ</td></tr>";
              return;
            }
            tbody.innerHTML = "";
            data.forEach(car => {
              const tr = document.createElement("tr");
              tr.innerHTML = `
                <td>${car.id}</td>
                <td>${car.brand}</td>
                <td>${car.model || '-'}</td>
                <td>${car.year || '-'}</td>
                <td>${car.licensePlate || '-'}</td>
                <td>${car.status}</td>
                <td>${car.purchasePrice || '-'}</td>
                <td>${car.salePrice || '-'}</td>
                <td>
                  <button class="edit" onclick="editCar(${car.id}, '${car.brand}', '${car.model || ''}', '${car.year || ''}', '${car.licensePlate || ''}', '${car.status}', '${car.purchasePrice || ''}', '${car.salePrice || ''}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                  <button class="delete" onclick="deleteCar(${car.id})">‡∏•‡∏ö</button>
                </td>`;
              tbody.appendChild(tr);
            });
          } catch (err) {
            tbody.innerHTML = "<tr><td colspan='9' style='color:red;'>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÑ‡∏î‡πâ</td></tr>";
            console.error(err);
          }
        }

        async function addCar(event) {
          event.preventDefault();
          const form = event.target;
          const data = {
            brand: form.brand.value,
            model: form.model.value,
            year: parseInt(form.year.value),
            licensePlate: form.licensePlate.value,
            status: form.status.value,
            purchasePrice: parseFloat(form.purchasePrice.value),
            salePrice: parseFloat(form.salePrice.value)
          };
          try {
            await apiFetch("/api/cars", {
              method: "POST",
              body: JSON.stringify(data)
            });
            alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            form.reset();
            loadCars();
          } catch (err) {
            alert("‚ùå ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            console.error(err);
          }
        }

        async function deleteCar(id) {
          if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
          try {
            await fetch(`${API_BASE}/api/cars/${id}`, { method: "DELETE" });
            alert("üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
            loadCars();
          } catch (err) {
            alert("‚ùå ‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            console.error(err);
          }
        }

        function editCar(id, brand, model, year, licensePlate, status, purchasePrice, salePrice) {
          const form = document.getElementById("carForm");
          form.carId.value = id;
          form.brand.value = brand;
          form.model.value = model;
          form.year.value = year;
          form.licensePlate.value = licensePlate;
          form.status.value = status;
          form.purchasePrice.value = purchasePrice;
          form.salePrice.value = salePrice;
          form.querySelector("button[type='submit']").innerText = "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç";
        }

        async function saveCarEdit(event) {
          event.preventDefault();
          const form = event.target;
          const id = form.carId.value;
          const data = {
            brand: form.brand.value,
            model: form.model.value,
            year: parseInt(form.year.value),
            licensePlate: form.licensePlate.value,
            status: form.status.value,
            purchasePrice: parseFloat(form.purchasePrice.value),
            salePrice: parseFloat(form.salePrice.value)
          };
          try {
            await apiFetch(`/api/cars/${id}/status`, {
              method: "PATCH",
              body: JSON.stringify({ status: data.status })
            });
            alert("‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            form.reset();
            form.querySelector("button[type='submit']").innerText = "‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà";
            loadCars();
          } catch (err) {
            alert("‚ùå ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            console.error(err);
          }
        }

        window.addEventListener("DOMContentLoaded", loadCars);
    </script>
</head>

<body>
<header>
    <div>üöò ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏ñ</div>
    <a href="index.html">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Dashboard</a>
</header>

<main>
    <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
    <table id="carTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠</th>
            <th>‡∏£‡∏∏‡πà‡∏ô</th>
            <th>‡∏õ‡∏µ</th>
            <th>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠</th>
            <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢</th>
            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h3>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏£‡∏ñ</h3>
    <form id="carForm" onsubmit="event.target.carId.value ? saveCarEdit(event) : addCar(event)">
        <input type="hidden" name="carId">
        <input type="text" name="brand" placeholder="‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠" required>
        <input type="text" name="model" placeholder="‡∏£‡∏∏‡πà‡∏ô">
        <input type="number" name="year" placeholder="‡∏õ‡∏µ">
        <input type="text" name="licensePlate" placeholder="‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ"><br>
        <select name="status" required>
            <option value="AVAILABLE">AVAILABLE</option>
            <option value="SOLD">SOLD</option>
            <option value="MAINTENANCE">MAINTENANCE</option>
        </select>
        <input type="number" name="purchasePrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠" step="0.01">
        <input type="number" name="salePrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢" step="0.01"><br>
        <button type="submit">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏ñ‡πÉ‡∏´‡∏°‡πà</button>
    </form>
</main>

<footer>¬© 2025 CarBiz Management System</footer>
</body>
</html>
