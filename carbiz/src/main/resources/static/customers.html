<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>üë§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ | CarBiz</title>
    <style>
        body {
          font-family: "Segoe UI", sans-serif;
          background: #f8f9fa;
          margin: 0;
          color: #333;
        }
        header {
          background: #0d6efd;
          color: white;
          padding: 15px;
          font-size: 22px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        header a {
          color: white;
          text-decoration: none;
          background: rgba(255,255,255,0.2);
          padding: 5px 12px;
          border-radius: 6px;
        }
        main { padding: 30px; }
        table {
          width: 100%;
          border-collapse: collapse;
          background: white;
          border-radius: 8px;
          overflow: hidden;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
          margin-top: 10px;
        }
        th, td {
          padding: 10px;
          border-bottom: 1px solid #ddd;
          text-align: left;
        }
        th { background: #0d6efd; color: white; }
        button {
          border: none; background: #0d6efd; color: white;
          padding: 6px 10px; border-radius: 5px; cursor: pointer;
          margin: 2px;
        }
        button.delete { background: #dc3545; }
        button.edit { background: #198754; }
        form {
          background: white;
          padding: 20px;
          border-radius: 8px;
          margin-top: 20px;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        input {
          padding: 6px;
          margin: 4px;
          border: 1px solid #ccc;
          border-radius: 5px;
        }
        footer {
          text-align: center;
          color: #777;
          margin-top: 40px;
          padding: 10px;
        }
    </style>

    <script>
        const API_BASE = "http://localhost:8080";

        async function apiFetch(endpoint, options = {}) {
          const res = await fetch(`${API_BASE}${endpoint}`, {
            headers: { "Content-Type": "application/json" },
            ...options
          });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return await res.json();
        }

        async function loadCustomers() {
          const tbody = document.querySelector("#customerTable tbody");
          tbody.innerHTML = "<tr><td colspan='8'>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>";
          try {
            const customers = await apiFetch("/api/customers");
            if (customers.length === 0) {
              tbody.innerHTML = "<tr><td colspan='8'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</td></tr>";
              return;
            }
            tbody.innerHTML = "";
            customers.forEach(c => {
              const tr = document.createElement("tr");
              tr.innerHTML = `
                <td>${c.id}</td>
                <td>${c.firstName}</td>
                <td>${c.lastName}</td>
                <td>${c.phone || '-'}</td>
                <td>${c.email || '-'}</td>
                <td>${c.nationalId || '-'}</td>
                <td>${c.address || '-'}</td>
                <td>
                  <button class="edit" onclick="editCustomer(${c.id}, '${c.firstName}', '${c.lastName}', '${c.phone || ''}', '${c.email || ''}', '${c.nationalId || ''}', '${c.address || ''}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                  <button class="delete" onclick="deleteCustomer(${c.id})">‡∏•‡∏ö</button>
                </td>`;
              tbody.appendChild(tr);
            });
          } catch (err) {
            tbody.innerHTML = "<tr><td colspan='8' style='color:red;'>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÑ‡∏î‡πâ</td></tr>";
            console.error(err);
          }
        }

        async function addCustomer(event) {
          event.preventDefault();
          const form = event.target;
          const data = {
            firstName: form.firstName.value,
            lastName: form.lastName.value,
            phone: form.phone.value,
            email: form.email.value,
            nationalId: form.nationalId.value,
            address: form.address.value
          };
          try {
            await apiFetch("/api/customers", {
              method: "POST",
              body: JSON.stringify(data)
            });
            alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            form.reset();
            loadCustomers();
          } catch (err) {
            alert("‚ùå ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            console.error(err);
          }
        }

        async function deleteCustomer(id) {
          if (!confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
          try {
            await fetch(`${API_BASE}/api/customers/${id}`, { method: "DELETE" });
            alert("üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
            loadCustomers();
          } catch (err) {
            alert("‚ùå ‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            console.error(err);
          }
        }

        function editCustomer(id, firstName, lastName, phone, email, nationalId, address) {
          const form = document.getElementById("customerForm");
          form.customerId.value = id;
          form.firstName.value = firstName;
          form.lastName.value = lastName;
          form.phone.value = phone;
          form.email.value = email;
          form.nationalId.value = nationalId;
          form.address.value = address;
          form.querySelector("button[type='submit']").innerText = "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç";
        }

        async function saveCustomerEdit(event) {
          event.preventDefault();
          const form = event.target;
          const id = form.customerId.value;
          const data = {
            firstName: form.firstName.value,
            lastName: form.lastName.value,
            phone: form.phone.value,
            email: form.email.value,
            nationalId: form.nationalId.value,
            address: form.address.value
          };
          try {
            await apiFetch(`/api/customers/${id}`, {
              method: "PUT",
              body: JSON.stringify(data)
            });
            alert("‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            form.reset();
            form.querySelector("button[type='submit']").innerText = "‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà";
            loadCustomers();
          } catch (err) {
            alert("‚ùå ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            console.error(err);
          }
        }

        window.addEventListener("DOMContentLoaded", loadCustomers);
    </script>
</head>

<body>
<header>
    <div>üë§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
    <a href="index.html">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Dashboard</a>
</header>

<main>
    <h2>‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
    <table id="customerTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠</th>
            <th>‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
            <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
            <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
            <th>‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</th>
            <th>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</th>
            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h3>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏° / ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
    <form id="customerForm" onsubmit="event.target.customerId.value ? saveCustomerEdit(event) : addCustomer(event)">
        <input type="hidden" name="customerId">
        <input type="text" name="firstName" placeholder="‡∏ä‡∏∑‡πà‡∏≠" required>
        <input type="text" name="lastName" placeholder="‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required><br>
        <input type="text" name="phone" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£">
        <input type="email" name="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•"><br>
        <input type="text" name="nationalId" placeholder="‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô">
        <input type="text" name="address" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà"><br>
        <button type="submit">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</button>
    </form>
</main>

<footer>¬© 2025 CarBiz Management System</footer>
</body>
</html>
