<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>üîß ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á | CarBiz</title>
    <style>
        body {
          font-family: "Segoe UI", sans-serif;
          background: #f8f9fa;
          margin: 0;
          color: #333;
        }
        header {
          background: #0d6efd;
          color: white;
          padding: 15px;
          font-size: 22px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        header a {
          color: white;
          text-decoration: none;
          background: rgba(255,255,255,0.2);
          padding: 5px 12px;
          border-radius: 6px;
        }
        main { padding: 30px; }
        table {
          width: 100%;
          border-collapse: collapse;
          background: white;
          border-radius: 8px;
          overflow: hidden;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
          margin-top: 10px;
        }
        th, td {
          padding: 10px;
          border-bottom: 1px solid #ddd;
          text-align: left;
        }
        th { background: #0d6efd; color: white; }
        button {
          border: none; background: #0d6efd; color: white;
          padding: 6px 10px; border-radius: 5px; cursor: pointer;
          margin: 2px;
        }
        button.delete { background: #dc3545; }
        form {
          background: white;
          padding: 20px;
          border-radius: 8px;
          margin-top: 20px;
          box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        input, textarea {
          padding: 6px;
          margin: 4px;
          border: 1px solid #ccc;
          border-radius: 5px;
          width: calc(100% - 20px);
        }
        label {
          font-weight: bold;
        }
        footer {
          text-align: center;
          color: #777;
          margin-top: 40px;
          padding: 10px;
        }
    </style>

    <script>
        const API_BASE = "http://localhost:8080";

        async function apiFetch(endpoint, options = {}) {
          const res = await fetch(`${API_BASE}${endpoint}`, {
            headers: { "Content-Type": "application/json" },
            ...options
          });
          if (!res.ok) throw new Error(`HTTP ${res.status}`);
          return await res.json();
        }

        async function loadMaintenance() {
          const carId = document.getElementById("carIdInput").value.trim();
          const tbody = document.querySelector("#maintTable tbody");
          if (!carId) {
            tbody.innerHTML = "<tr><td colspan='5'>‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô</td></tr>";
            return;
          }

          tbody.innerHTML = "<tr><td colspan='5'>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>";
          try {
            const data = await apiFetch(`/api/maintenance/car/${carId}`);
            if (data.length === 0) {
              tbody.innerHTML = "<tr><td colspan='5'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡∏Ñ‡∏±‡∏ô‡∏ô‡∏µ‡πâ</td></tr>";
              return;
            }
            tbody.innerHTML = "";
            data.forEach(m => {
              const tr = document.createElement("tr");
              tr.innerHTML = `
                <td>${m.id}</td>
                <td>${m.detail}</td>
                <td>${m.date}</td>
                <td>${m.cost} ‡∏ö‡∏≤‡∏ó</td>
                <td><button class="delete" onclick="deleteMaintenance(${m.id}, ${carId})">‡∏•‡∏ö</button></td>`;
              tbody.appendChild(tr);
            });
          } catch (err) {
            tbody.innerHTML = "<tr><td colspan='5' style='color:red;'>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ API ‡πÑ‡∏î‡πâ</td></tr>";
            console.error(err);
          }
        }

        async function addMaintenance(event) {
          event.preventDefault();
          const carId = document.getElementById("carIdInput").value.trim();
          const form = event.target;

          if (!carId) {
            alert("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
            return;
          }

          const data = {
            carId: parseInt(carId),
            detail: form.detail.value,
            date: form.date.value,
            cost: parseFloat(form.cost.value)
          };

          try {
            await apiFetch("/api/maintenance", {
              method: "POST",
              body: JSON.stringify(data)
            });
            alert("‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            form.reset();
            loadMaintenance();
          } catch (err) {
            alert("‚ùå ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            console.error(err);
          }
        }

        async function deleteMaintenance(id, carId) {
          if (!confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
          try {
            await fetch(`${API_BASE}/api/maintenance/${id}`, { method: "DELETE" });
            alert("üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
            loadMaintenance();
          } catch (err) {
            alert("‚ùå ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
            console.error(err);
          }
        }
    </script>
</head>

<body>
<header>
    <div>üîß ‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á</div>
    <a href="index.html">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Dashboard</a>
</header>

<main>
    <h2>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ï‡∏≤‡∏°‡∏£‡∏ñ</h2>
    <input type="number" id="carIdInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏£‡∏ñ (Car ID)">
    <button onclick="loadMaintenance()">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>

    <table id="maintTable">
        <thead>
        <tr>
            <th>ID</th>
            <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏°</th>
            <th>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</th>
            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h3>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</h3>
    <form onsubmit="addMaintenance(event)">
        <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°:</label><br>
        <textarea name="detail" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." required></textarea><br>

        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏°:</label><br>
        <input type="date" name="date" required><br>

        <label>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó):</label><br>
        <input type="number" name="cost" step="0.01" required><br>

        <button type="submit">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</button>
    </form>
</main>

<footer>¬© 2025 CarBiz Management System</footer>
</body>
</html>
